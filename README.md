# Telegram отчетный бот (aiogram 3)

Бот отслеживает, кто отправил отчет в тему (topic) "Отчеты" и в момент дедлайна присылает список отчитавшихся и неотчитавшихся.

## Возможности

- фиксирует сообщения в нужной теме (topic) группы;
- хранит отчеты по дням в SQLite;
- в дедлайн публикует список отчитавшихся/неотчитавшихся;
- команда `/reportstatus` показывает текущий статус по дню.

## Быстрый старт

1. Установите зависимости:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

2. Создайте файл `.env` рядом с `main.py`:

```env
BOT_TOKEN=123456:ABCDEF
CHAT_ID=-1001234567890
REPORT_THREAD_ID=12345
TIMEZONE=Europe/Moscow
SETTINGS_PATH=settings.json
REQUIRED_USER_IDS=11111111,22222222,33333333
```

- `CHAT_ID` — ID группы.
- `REPORT_THREAD_ID` — ID темы (topic), где пишутся отчеты.
- `SETTINGS_PATH` — путь к файлу настроек (ниже пример).
- `REQUIRED_USER_IDS` — запасной список участников, если не заполнять файл настроек.

3. Создайте `settings.json` рядом с `main.py` для удобной правки дедлайнов и списка людей:

```json
{
  "required_users": [
    {"id": 11111111, "name": "Иван Петров", "username": "ivanpetrov"},
    {"id": 22222222, "name": "Ольга", "username": "olga"}
  ],
  "deadlines": [
    {
      "key": "morning",
      "title": "Утренний отчет",
      "tag": "#УтреннийОтчет",
      "weekday_time": "11:00",
      "weekend_time": "12:00"
    },
    {
      "key": "evening",
      "title": "Вечерний отчет",
      "tag": "#ВечернийОтчет",
      "weekday_time": "18:00",
      "weekend_time": "19:00"
    }
  ]
}
```

- `tag` — хештег, который должны указывать люди в отчете.
- `weekday_time` / `weekend_time` — разное время для будней и выходных.

4. Запуск:

```bash
python main.py
```

## Как узнать ID темы

Включите режим администратора в боте @RawDataBot или @getidsbot и отправьте сообщение в нужную тему — в ответе будет `message_thread_id`.

## Важно

Telegram не дает боту полный список участников группы, поэтому список обязанных пользователей задается через `REQUIRED_USER_IDS`.

Если вы обновляете уже существующую базу `data.db`, бот сам добавит недостающие колонки. В редких случаях проще удалить старый `data.db`, чтобы он создался заново.
